<!-- âœ… Matchxsofascore13.js FINAL -->
<script>
// --- Fungsi Utama Load Sofascore + Countdown ---
function loadSofaScore(matchId, boxId) {
  const eventUrl = `https://api.sofascore.com/api/v1/event/${matchId}`;

  fetch(eventUrl)
    .then(res => res.json())
    .then(data => {
      const event = data.event;
      const home = event.homeTeam;
      const away = event.awayTeam;

      // Nama & logo liga
      const leagueEl = document.getElementById("league" + boxId);
      if (leagueEl) {
        leagueEl.innerHTML = `
          <span style="display:inline-flex;align-items:center;">
            <img src="https://api.sofascore.app/api/v1/unique-tournament/${event.tournament.uniqueTournament.id}/image/dark"
                 alt="${event.tournament.name}"
                 style="height:18px;width:18px;margin-right:4px;">
            <span>${event.tournament.name}</span>
          </span>`;
      }

      // Jadwal kickoff otomatis zona waktu pengunjung
      const kickoffDate = new Date(event.startTimestamp * 1000);
      const tanggal = kickoffDate.toLocaleDateString(undefined, {
          day: '2-digit', month: 'long', year: 'numeric'
      });
      const jam = kickoffDate.toLocaleTimeString(undefined, {
          hour: '2-digit', minute: '2-digit', hour12: false, timeZoneName: 'short'
      });
      document.getElementById("kickoff" + boxId).innerHTML = `${tanggal} | K.O ${jam}`;

      // Logo + Nama Tim kiri-kanan
      const teamsEl = document.getElementById("teams" + boxId);
      if (teamsEl) {
        teamsEl.innerHTML = `
          <div style="display:flex; align-items:center; justify-content:space-between; width:100%; max-width:300px; margin:auto;">
            <div style="display:flex; align-items:center; text-align:left;">
              <img src="https://api.sofascore.app/api/v1/team/${home.id}/image" 
                   style="height:35px; width:35px; border-radius:5px; margin-right:6px;">
              <span style="font-weight:bold; color:white;">${home.name}</span>
            </div>
            <strong style="font-size:16px; color:orange;">VS</strong>
            <div style="display:flex; align-items:center; text-align:right;">
              <span style="font-weight:bold; color:white; margin-right:6px;">${away.name}</span>
              <img src="https://api.sofascore.app/api/v1/team/${away.id}/image" 
                   style="height:35px; width:35px; border-radius:5px;">
            </div>
          </div>`;
      }

      startCountdown(kickoffDate.getTime(), boxId);
      monitorMatchStatus(matchId, boxId);
    });
}

// --- Monitoring status pertandingan ---
function monitorMatchStatus(matchId, boxId) {
  const eventUrl = `https://api.sofascore.com/api/v1/event/${matchId}`;
  const liveContainer = document.getElementById("liveContainer" + boxId);
  const liveScoreEl = document.getElementById("liveScore" + boxId);
  const matchStatusEl = document.getElementById("matchStatus" + boxId);
  const countdownEl = document.getElementById("countdown" + boxId);

  const interval = setInterval(async () => {
    const res = await fetch(eventUrl);
    const data = await res.json();
    const event = data.event;
    if (!event) return;

    if (event.status.type === "inprogress") {
      liveContainer.innerHTML = "<strong style='color:red;'>ðŸ”´ LIVE</strong>";
      liveScoreEl.innerHTML = `${event.homeScore.current} - ${event.awayScore.current}`;
      matchStatusEl.innerHTML = event.status.description || "LIVE";
    } 
    else if (event.status.type === "finished") {
      liveContainer.innerHTML = "<strong style='color:gray;'>â›” ENDED</strong>";
      liveScoreEl.innerHTML = `${event.homeScore.current} - ${event.awayScore.current}`;
      matchStatusEl.innerHTML = "Full Time";
      clearInterval(interval);
    }
  }, 3000);
}

// --- Countdown Waktu Kickoff ---
function startCountdown(targetTime, boxId) {
  const countdownId = "countdown" + boxId;
  window["countdown_" + boxId] = setInterval(() => {
    const now = Date.now();
    const diff = targetTime - now;
    const el = document.getElementById(countdownId);
    if (!el) return;

    if (diff <= 0) {
      el.innerHTML = "Kickoff Soon!";
      clearInterval(window["countdown_" + boxId]);
    } else {
      const h = Math.floor(diff / (1000*60*60));
      const m = Math.floor((diff % (1000*60*60)) / (1000*60));
      const s = Math.floor((diff % (1000*60)) / 1000);
      el.innerHTML = `${h}H ${m}M ${s}S`;
    }
  }, 1000);
}

// --- Fungsi Render Box (pemanggil) ---
function renderMatch(matchId, matchKey, serverFuncs, boxClass = "kotak", tvServerTime = null) {
  const container = document.createElement("div");
  container.className = `${boxClass}`;
  container.id = `match${matchKey}`;
  container.innerHTML = `
    <div id="countdown${matchKey}"></div>
    <div id="liveContainer${matchKey}"></div>
    <div id="league${matchKey}"></div>
    <div id="teams${matchKey}"></div>
    <div id="kickoff${matchKey}"></div>
    <div id="liveScore${matchKey}"></div>
    <div id="matchStatus${matchKey}"></div>
    <div id="tvCountdown${matchKey}" style="color:yellow;font-weight:bold;"></div>
    <div style="margin-top:5px;">
      ${serverFuncs.map((fn, i) =>
        `<a class="tv" id="tvServer${matchKey}_${i}" href="javascript:${fn}();" style="color:orange;margin:0 3px;">SERVER ${i+1}</a>`
      ).join("")}
    </div>
  `;
  document.body.appendChild(container);
  loadSofaScore(matchId, matchKey);
}
</script>
